# Проект: Система измерения каталитической активности

## Описание
Программа управляет экспериментальной установкой для измерения каталитической активности с использованием светодиодного излучения. Система контролирует ультрафиолетовый диод для активации катализатора, красный лазер для измерений и датчик освещенности для регистрации результатов. Данные записываются на SD-карту и передаются через последовательный порт.

## Конфигурация пинов Arduino

### Используемые пины

#### Цифровые пины:
- **Пин 2** (RX SoftwareSerial): Прием данных от внешнего устройства управления
- **Пин 3** (TX SoftwareSerial): Передача данных на внешнее устройство управления
- **Пин 7** (RED_LASER_PIN): Управление красным лазером (ВКЛ/ВЫКЛ)
- **Пин 8** (UV_DIODE_PIN): Управление ультрафиолетовым диодом (ВКЛ/ВЫКЛ)
- **Пин 10** (SD_CS_PIN): Выбор чипа (Chip Select) для SD-карты

#### Аналоговые пины:
- **A4 (SDA)**: Данные для I2C (подключение датчика BH1750)
- **A5 (SCL)**: Тактовый сигнал для I2C (подключение датчика BH1750)

#### Шины:
- **SPI** (через аппаратные пины):
  - MOSI (Pin 11): Данные от Master к Slave
  - MISO (Pin 12): Данные от Slave к Master
  - SCK (Pin 13): Тактовый сигнал SPI
  - SS (Pin 10): Выбор устройства (используется для SD-карты)

### Свободные пины

#### Цифровые пины:
- **Пин 0** (RX): Свободен (можно использовать для второго последовательного порта)
- **Пин 1** (TX): Свободен (можно использовать для второго последовательного порта)
- **Пин 4**: Свободен (общего назначения)
- **Пин 5**: Свободен (общего назначения, поддерживает ШИМ)
- **Пин 6**: Свободен (общего назначения, поддерживает ШИМ)
- **Пин 9**: Свободен (общего назначения, поддерживает ШИМ)
- **Пин 11**: Используется SPI MOSI, но может быть использован как цифровой, если не используется SPI
- **Пин 12**: Используется SPI MISO, но может быть использован как цифровой, если не используется SPI
- **Пин 13**: Используется SPI SCK, но может быть использован как цифровой, если не используется SPI

#### Аналоговые пины:
- **A0**: Свободен (аналоговый вход/цифровой пин)
- **A1**: Свободен (аналоговый вход/цифровой пин)
- **A2**: Свободен (аналоговый вход/цифровой пин)
- **A3**: Свободен (аналоговый вход/цифровой пин)
- **A6**: Свободен (только аналоговый вход)
- **A7**: Свободен (только аналоговый вход)

## Подключение периферии

### 1. Датчик освещенности BH1750
```
BH1750 -> Arduino
VCC    -> 5V или 3.3V
GND    -> GND
SDA    -> A4 (SDA)
SCL    -> A5 (SCL)
ADDR   -> Не подключен (или GND/VCC для изменения адреса)
```

### 2. Модуль SD-карты
```
SD Module -> Arduino
CS        -> Pin 10
MOSI      -> Pin 11
MISO      -> Pin 12
SCK       -> Pin 13
VCC       -> 5V
GND       -> GND
```

### 3. Внешний интерфейс управления (SoftwareSerial)
```
Внешнее устройство -> Arduino
TX                -> Pin 2 (RX SoftwareSerial)
RX                -> Pin 3 (TX SoftwareSerial)
GND               -> Общий GND
```

### 4. Силовые элементы
```
Красный лазер -> Arduino
Управление    -> Pin 7 через транзистор/драйвер
Питание       -> Отдельный источник питания

УФ диод -> Arduino
Управление -> Pin 8 через транзистор/драйвер
Питание    -> Отдельный источник питания
```

## Протокол управления

Система принимает команды через SoftwareSerial (пины 2 и 3) в формате:
`код_команды,параметр1,параметр2,параметр3,строка;`

### Доступные команды:
1. **369** - Установка параметров:
2. **1** - Запуск измерений:
3. **2** - Остановка измерений:
4. **3** - Включение красного лазера (тестовый режим):
5. **4** - Выключение красного лазера:

## Формат данных

Данные записываются на SD-карту в текстовый файл в формате:
```
номер_цикла\tвремя_с_начала_измерения\tуровень_освещенности
```

Пример:
```
0	0	123.45
1	2000	120.50
2	4000	118.75
```

## Требования к библиотекам

1. **Wire** - стандартная библиотека Arduino для I2C
2. **BH1750** - для работы с датчиком освещенности
3. **SPI** - стандартная библиотека для SPI интерфейса
4. **SdFat** - для работы с SD-картой
5. **SoftwareSerial** - для создания дополнительного последовательного порта
6. **GParser** - для разбора входящих команд
